{"version":3,"file":null,"sources":["../src/line.js","../src/day.js","../src/widget.js"],"sourcesContent":["const {React} = Serverboards\n\nconst mimetypes_to_icon={\n  \"application/zip\": \"compress\",\n  \"application/vnd.google-apps.document\": \"file word outline\",\n  \"application/vnd.google-apps.presentation\" : \"file powerpoint outline\",\n  \"application/vnd.google-apps.folder\": \"folder\",\n  \"image\" : \"file image outline\"\n}\n\nfunction get_icon_for(props){\n  console.log(props.type)\n  const maintype = props.type.split(\"/\")[0]\n  return mimetypes_to_icon[props.type] || mimetypes_to_icon[maintype] || \"file green\"\n}\n\nfunction DriveLine(props){\n  return (\n    <div className=\"entry\">\n      <div className=\"icon\">\n        <a href={props.viewLink} target=\"_blank\">\n          <i className={`ui icon ${get_icon_for(props)} big`}/>\n        </a>\n      </div>\n      <div className=\"data\">\n        <b>{props.author} </b>\n        {props.what}\n        <b> <a href={props.viewLink} target=\"_blank\">{props.file}</a> </b>\n        {props.to ? (\n          <span>\n            {props.what==\"removed\" ? \"from\" : \"at\"}\n            <a href={props.to_link} target=\"_blank\"><b> {props.to} </b></a>\n          </span>\n        ) : null}\n      </div>\n      <div className=\"time\">\n        <div>\n          {props.time}\n        </div>\n        <div className=\"download\">\n          {props.downloadLink ? (\n            <a href={props.downloadLink} target=\"_blank\">\n              <i className=\"ui icon download\"/>\n            </a>\n          ) : null }\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default DriveLine\n","const {React, utils, moment} = Serverboards\nimport Line from './line'\n\nfunction DriveDay(props){\n  return (\n    <div>\n      <div className=\"date\">{utils.pretty_ago(props.date, moment(), \"day\")}</div>\n      {props.entries.map( l => (\n        <Line {...l}/>\n      ))}\n    </div>\n  )\n}\n\nexport default DriveDay\n","const {rpc, React, plugin, Components, Flash} = Serverboards\nconst plugin_id=\"serverboards.google.drive\"\nimport Day from './day'\n\nfunction View(props){\n  return (\n    <div className=\"google drive\">\n      {props.days.map( d => (\n        <Day {...d}/>\n      ))}\n    </div>\n  )\n}\n\nlet drive\n\nconst Model = React.createClass({\n  getInitialState(){\n    return {lines:[], loading: true, error: false, link: false}\n  },\n  update(){\n    const folder_filter = this.props.config.folder_filter\n      .split(',')\n      .map( s => s.trim() )\n      .filter( s => s!=\"\" );\n    drive.call(\"get_changes\", [this.props.config.service.uuid, folder_filter]).then( (changes) => {\n      this.setState({lines: changes, loading: false})\n    }).catch( (e) => {\n      if (e==\"invalid_grant\"){\n        drive.call(\"authorize_url\", [this.props.config.service]).then( (url) => {\n          this.setState({error: \"Google Drive grant has expired and was not automatically refreshed. Click here to renew.\", link: url})\n          Flash.error(e)\n        })\n      }\n      else{\n        this.setState({error: e})\n        Flash.error(e)\n      }\n    })\n  },\n  componentDidMount(){\n    plugin.start(\"serverboards.google.drive/daemon\")\n      .then( function(_drive){\n        drive=_drive\n      } ).then( this.update )\n  },\n  render(){\n    if (this.state.error){\n      return (\n        <div className=\"ui message error\">\n          {this.state.link ? (\n            <a href={this.state.link} target=\"_blank\">{this.state.error}</a>\n          ): this.state.error }\n        </div>\n      )\n    }\n    if (this.state.loading)\n      return (\n        <Components.Loading>Google Drive Changes</Components.Loading>\n      )\n    return (\n      <View days={this.state.lines}/>\n    )\n  }\n})\n\nfunction main(el, config, extra){\n  extra.setTitle(\"Google Drive activity\")\n  $(el).css(\"overflow\", \"auto\")\n  Serverboards.ReactDOM.render(<Model config={config}/>, el)\n\n  return function(){\n    Serverboards.ReactDOM.unmountComponentAtNode(el)\n  }\n}\n\nServerboards.add_widget(`${plugin_id}/widget`, main)\n"],"names":["Serverboards","React","mimetypes_to_icon","props","console","log","type","split","maintype","viewLink","get_icon_for","author","what","file","to","to_link","time","downloadLink","utils","moment","pretty_ago","date","entries","map","Line","l","rpc","plugin","Components","Flash","plugin_id","days","Day","d","Model","createClass","getInitialState","lines","loading","error","link","update","folder_filter","config","trim","filter","drive","call","service","uuid","then","changes","setState","catch","e","url","componentDidMount","start","_drive","render","state","el","extra","setTitle","$","css","ReactDOM","unmountComponentAtNode","add_widget","main"],"mappings":"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"}